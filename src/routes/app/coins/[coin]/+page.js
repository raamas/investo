export const load = async ({ fetch, params }) => {
	let response = await fetch(`https://api.coingecko.com/api/v3/coins/${params.coin}`, {
		headers: {
			'Access-Control-Allow-Origin': '*',
			'x-cg-demo-api-key': 'CG-kEGJyr6Q6JmNXwdeATYb6rzn'
		}
	});
	let data = await response.json();
	let currentDate = Math.floor(Date.now() / 1000);
	let lastYear = Math.floor(currentDate - 365 * 24 * 60 * 60);

	let url = `https://api.coingecko.com/api/v3/coins/${params.coin}/market_chart/range?vs_currency=usd&from=${lastYear}&to=${currentDate}`;
	let chartResponse = await fetch(url);
	console.log(url);

	let chart = await chartResponse.json();
	console.log(chart.prices.length);

	let prices = [];

	// Reduce to 6 months
	for (let i = 0; i < 12; i++) {
		let month;
		month = new Date(Date.now() - i * 30 * 24 * 60 * 60 * 1000);
		// month = month.toLocaleString('default', { month: 'long' });
		// parse the first day of the month
		// month = ;
		let element = {
			month: new Date(month.getFullYear(), month.getMonth(), 1),
			price: chart.prices[i * 30][1]
		};
		console.log(element);
		prices.push(element);
	}

	prices = prices.reverse();
	data.chart = prices;
	return { ...data };
};

// [
//   [ 1735516800000, 5.631708751359423 ],
//   [ 1735603200000, 5.576159643459067 ],
//   [ 1735689600000, 5.487637356709536 ],
//   [ 1735776000000, 5.496613562755931 ],
//   [ 1735862400000, 5.636853487967384 ],
//   [ 1735948800000, 5.786568295710314 ],
//   [ 1736035200000, 5.725893829715287 ],
//   [ 1736121600000, 5.724603964272338 ],
//   [ 1736208000000, 5.704907592562007 ],
//   [ 1736294400000, 5.325295759199877 ],
//   [ 1736380800000, 5.312102626245957 ],
//   [ 1736467200000, 5.201142307325583 ],
//   [ 1736553600000, 5.375943396325855 ],
//   [ 1736640000000, 5.399599531405128 ],
//   [ 1736726400000, 5.303461242215202 ],
//   [ 1736812800000, 5.291217934817292 ],
//   [ 1736899200000, 5.360520709207482 ],
//   [ 1736985600000, 5.519476616476303 ],
//   [ 1737072000000, 5.475952076975003 ],
//   [ 1737158400000, 5.594663942697051 ],
//   [ 1737244800000, 5.288735304108453 ],
//   [ 1737331200000, 4.852220679406567 ],
//   [ 1737417600000, 5.0131645296364935 ],
//   [ 1737504000000, 5.19924265001996 ],
//   [ 1737590400000, 5.279978709445243 ],
//   [ 1737676800000, 5.131569323308819 ],
//   [ 1737763200000, 5.057738031389834 ],
//   [ 1737849600000, 5.07992572676312 ],
//   [ 1737936000000, 4.932218643970656 ],
//   [ 1738022400000, 5.01131114407696 ],
//   [ 1738108800000, 4.789362053710251 ],
//   [ 1738195200000, 4.830030677681154 ],
//   [ 1738281600000, 4.818373354260492 ],
//   [ 1738368000000, 4.825859129820997 ],
//   [ 1738454400000, 4.5970803295540925 ],
//   [ 1738540800000, 4.036465270678325 ],
//   [ 1738627200000, 4.074085309408775 ],
//   [ 1738713600000, 3.798740090272049 ],
//   [ 1738800000000, 3.784515370800481 ],
//   [ 1738886400000, 3.729983732852677 ],
//   [ 1738972800000, 3.7171105649982468 ],
//   [ 1739059200000, 3.7442762975519823 ],
//   [ 1739145600000, 3.8379454462140634 ],
//   [ 1739232000000, 3.813417599449371 ],
//   [ 1739318400000, 3.746512565928059 ],
//   [ 1739404800000, 3.819506805226295 ],
//   [ 1739491200000, 3.7142720456442793 ],
//   [ 1739577600000, 3.848225871734414 ],
//   [ 1739664000000, 3.795856278959157 ],
//   [ 1739750400000, 3.77941519909196 ],
//   [ 1739836800000, 3.7613310264299527 ],
//   [ 1739923200000, 3.6673640012918645 ],
//   [ 1740009600000, 3.5399406655174817 ],
//   [ 1740096000000, 3.6094033730956987 ],
//   [ 1740182400000, 3.5603177805830972 ],
//   [ 1740268800000, 3.743209328495989 ],
//   [ 1740355200000, 3.768021880828715 ],
//   [ 1740441600000, 3.4046785906678396 ],
//   [ 1740528000000, 3.5507811484301643 ],
//   [ 1740614400000, 3.4928094674665275 ],
//   [ 1740700800000, 3.4122315666972822 ],
//   [ 1740787200000, 3.3297654363252094 ],
//   [ 1740873600000, 3.3235092990772763 ],
//   [ 1740960000000, 3.513546868677179 ],
//   [ 1741046400000, 3.067218859002277 ],
//   [ 1741132800000, 3.115612126455826 ],
//   [ 1741219200000, 3.0323901894415597 ],
//   [ 1741305600000, 3.0400116099623378 ],
//   [ 1741392000000, 2.987524747720395 ],
//   [ 1741478400000, 2.9530168133736754 ],
//   [ 1741564800000, 2.6502384916268324 ],
//   [ 1741651200000, 2.534270256068397 ],
//   [ 1741737600000, 2.641455254159711 ],
//   [ 1741824000000, 2.744422884257101 ],
//   [ 1741910400000, 2.7620162737603158 ],
//   [ 1741996800000, 2.924615774751895 ],
//   [ 1742083200000, 3.58964358061839 ],
//   [ 1742169600000, 3.44439765179678 ],
//   [ 1742256000000, 3.4531883106361745 ],
//   [ 1742342400000, 3.560970183640854 ],
//   [ 1742428800000, 3.6620508609692655 ],
//   [ 1742515200000, 3.700146517561875 ],
//   [ 1742601600000, 3.5826525071493527 ],
//   [ 1742688000000, 3.6721304776270602 ],
//   [ 1742774400000, 3.6775425835704754 ],
//   [ 1742860800000, 3.6585219205711796 ],
//   [ 1742947200000, 3.5943363710254443 ],
//   [ 1743033600000, 3.7001294758108076 ],
//   [ 1743120000000, 4.041200921212078 ],
//   [ 1743206400000, 3.797397361302538 ],
//   [ 1743292800000, 3.6987702212287923 ],
//   [ 1743379200000, 3.89912688092662 ],
//   [ 1743465600000, 4.10782587847104 ],
//   [ 1743552000000, 4.053213806540597 ],
//   [ 1743638400000, 3.8453390983563516 ],
//   [ 1743724800000, 3.590941633397852 ],
//   [ 1743811200000, 3.4097693910035844 ],
//   [ 1743897600000, 3.262612781210701 ],
//   [ 1743984000000, 2.9112901040439025 ],
//   [ 1744070400000, 3.1119682285186556 ],
